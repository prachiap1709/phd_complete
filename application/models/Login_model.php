<?phpdefined('BASEPATH') OR exit('No direct script access allowed');class Login_model extends CI_Model {	public function authenticate($username, $userpass)	{		$this->db->select('id,fld_currency, fld_admin_type,fld_email,fld_name');		$this->db->from('tbl_admin');		$this->db->where('fld_password',md5($userpass));		$this->db->group_start();		$this->db->where('fld_username',$username);		$this->db->or_where('fld_email',$username);		$this->db->group_end();		$this->db->where('fld_admin_type!=','CLIENT');		$this->db->where('status','Active');		$query = $this->db->get();		//echo $this->db->last_query();		//echo $query->num_rows();		if($query->num_rows()>0)		{			$result = $query->row();						//echo preTagdata($result);			$acnt_mngr_id	= $result->fld_acnt_mngr_id;			$currency 		= $result->fld_currency;						$admin_type 	= $result->fld_admin_type;			$admin_name 	= $result->fld_name;			$admin_email 	= $result->fld_email;			$admin_id 		= $result->id;			//exit;			$this->session->set_userdata('adm_logged_in',true);			$this->session->set_userdata('adm_admin_name',$admin_name);						$this->session->set_userdata('adm_admin_email',$admin_email);			$this->session->set_userdata('adm_admin_id',$admin_id);			$this->session->set_userdata('adm_admin_type',$admin_type);						$this->session->set_userdata('adm_admin_acnt_mngr_id',$acnt_mngr_id);			if($this->session->userdata('adm_admin_type') == 'CLIENT')			{				$this->session->set_userdata('adm_admin_currency',$currency);								if(!empty($_SERVER['HTTP_CLIENT_IP'])){					//ip from share internet					$ip = $_SERVER['HTTP_CLIENT_IP'];				}elseif(!empty($_SERVER['HTTP_X_FORWARDED_FOR'])){					//ip pass from proxy					$ip = $_SERVER['HTTP_X_FORWARDED_FOR'];				}else{					$ip = $_SERVER['REMOTE_ADDR'];				}								$data = array(					'fld_clientid'		=>	$admin_id,										'fld_ipaddress'		=>	$ip,					'fld_login_time'	=>	date('Y-m-d H:i:s'),				);				$this->db->insert('tbl_login_history',$data);				$insertid = $this->db->insert_id();				$this->session->set_userdata('adm_admin_loginid',$insertid);			}			return true;		}		else		{			return false;		}	}		public function verify($verifycode,$userid)	{		$this->db->select('*');		$this->db->from('tbl_admin');		$this->db->where('fld_verify',$verifycode);		$this->db->where('id',$userid);		$this->db->where('status','Inactive');		$query = $this->db->get();		//echo $this->db->last_query();		//echo $query->num_rows();		//exit;		if($query->num_rows()>0)		{			$verify = rand(111111,999999);			//$data = array('fld_verify'=>'', 'fld_verify_mob'=>$verify);			$data = array('fld_verify'=>'', 'status'=>'Active');			$this->db->where('fld_verify',$verifycode);			$this->db->where('id',$userid);			$this->db->where('status','Inactive');			$query = $this->db->update('tbl_admin',$data);			return 'success';			//exit;		}		else		{			return 'danger';			//exit;		}	}}